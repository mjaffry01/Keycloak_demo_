<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Marketplace API Docs (Role Filtered)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --text:#e9ecff; --muted:#9fb0ff;
      --line:#26305a; --ok:#38d9a9; --warn:#ffd43b; --bad:#ff6b6b; --accent:#7aa2ff;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    body{ margin:0; padding:20px; background:var(--bg); color:var(--text); font-family:var(--sans); }
    .wrap{ max-width:1150px; margin:auto; }
    h1{ margin:0 0 6px; font-size:26px; }
    .sub{ margin:0 0 16px; color:var(--muted); line-height:1.45; }
    .topbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:14px 0 16px; }
    .tabs{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .tab{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px; border-radius:999px;
      border:1px solid var(--line); background:rgba(255,255,255,.03);
      color:var(--text); text-decoration:none; font-size:13px;
    }
    .tab.active{ border-color:var(--accent); box-shadow:0 0 0 2px rgba(122,162,255,.18) inset; }
    .pill{
      display:inline-block; padding:2px 10px; border-radius:999px; font-size:12px;
      border:1px solid var(--line); background:rgba(255,255,255,.03); color:var(--muted);
    }
    .pill.ok{ color:var(--ok); border-color:rgba(56,217,169,.35); }
    .pill.warn{ color:var(--warn); border-color:rgba(255,212,59,.35); }
    .pill.bad{ color:var(--bad); border-color:rgba(255,107,107,.35); }
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      margin-left:auto;
    }
    input[type="search"], select{
      background:#0a1026; color:var(--text);
      border:1px solid var(--line); border-radius:10px;
      padding:9px 10px; font-size:13px;
      outline:none;
    }
    label.chk{ display:inline-flex; gap:8px; align-items:center; color:var(--muted); font-size:13px; }
    .grid{ display:grid; gap:14px; grid-template-columns:1fr; }
    @media (min-width: 980px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:14px; padding:14px;
    }
    .card h2{ margin:0 0 6px; font-size:16px; }
    .meta{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:6px; }
    .method{ font-weight:900; font-size:12px; letter-spacing:.02em; }
    .GET{ color:#74c0fc; }
    .POST{ color:#b197fc; }
    .path{ font-family:var(--mono); font-size:12px; color:var(--text); opacity:.95; }
    .desc{ margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.45; }
    .code-wrap{ position:relative; margin-top:10px; }
    pre{
      background:#0a1026; border:1px solid var(--line);
      border-radius:12px; padding:12px; overflow:auto;
      font-family:var(--mono); font-size:13px; line-height:1.45; margin:0;
      white-space:pre;
    }
    .copy-btn{
      position:absolute; top:8px; right:8px;
      background:#1c2550; color:var(--text);
      border:1px solid var(--line);
      border-radius:8px; padding:5px 10px;
      font-size:12px; cursor:pointer; user-select:none;
    }
    .copy-btn:hover{ filter:brightness(1.08); }
    .copy-btn.ok{ background:#134e3a; border-color:#1f6f54; }
    .urls{
      background:#0a1026; border:1px solid var(--line);
      border-radius:14px; padding:12px; margin-bottom:14px;
    }
    .urls .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .url{
      font-family:var(--mono); font-size:12px; color:var(--muted);
      border:1px solid var(--line); background:rgba(255,255,255,.03);
      padding:6px 10px; border-radius:10px;
    }
    .small{ color:var(--muted); font-size:12px; margin-top:8px; line-height:1.45; }
  </style>
</head>

<body>
<div class="wrap">
  <h1>Marketplace API Docs</h1>
  <p class="sub">
    Filter by role. If you choose <b>Admin</b> you will see <b>only admin features</b>, same for Seller/Buyer.
    There‚Äôs also an <b>Everybody</b> view showing everything.
  </p>

  <div class="urls">
    <div class="row">
      <span class="pill">URLs</span>
      <span class="url" id="uAll"></span>
      <span class="url" id="uAdmin"></span>
      <span class="url" id="uSeller"></span>
      <span class="url" id="uBuyer"></span>
    </div>
    <div class="small">
      These are hash routes so they work even on <code>file://</code> (local HTML).
    </div>
  </div>

  <div class="topbar">
    <div class="tabs">
      <a class="tab" id="t-all" href="#/all">üåç Everybody</a>
      <a class="tab" id="t-admin" href="#/admin">üëë Admin</a>
      <a class="tab" id="t-seller" href="#/seller">üßë‚Äçüíº Seller</a>
      <a class="tab" id="t-buyer" href="#/buyer">üõí Buyer</a>
    </div>

    <div class="controls">
      <input id="q" type="search" placeholder="Search (path, description, tag)..." />
      <select id="method">
        <option value="all">All methods</option>
        <option value="GET">GET only</option>
        <option value="POST">POST only</option>
      </select>
      <label class="chk"><input id="authOnly" type="checkbox" /> Show auth-required only</label>
    </div>
  </div>

  <div class="grid" id="list"></div>
</div>

<script>
  // -------------------------
  // Copy utility (works on file://)
  // -------------------------
  function copyText(text) {
    if (navigator.clipboard && window.isSecureContext) {
      return navigator.clipboard.writeText(text);
    }
    return new Promise((resolve, reject) => {
      try {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "-9999px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        ok ? resolve() : reject(new Error("copy failed"));
      } catch (e) { reject(e); }
    });
  }

  // -------------------------
  // Endpoint dataset (aligned to your project zip DTOs/controllers)
  // -------------------------
  const endpoints = [
    // Everybody common helpers
    {
      id:"creds",
      group:"Everybody",
      role:["all"],
      method:"INFO",
      path:"Test Credentials",
      auth:false,
      tags:["creds","users"],
      desc:"Use these accounts to generate tokens via /api/auth-tester/token or /api/auth/login.",
      blocks:[
        { title:"Buyer creds", text:`{\n  "username": "test.buyer",\n  "password": "Pass@123"\n}` },
        { title:"Seller creds", text:`{\n  "username": "test.seller",\n  "password": "Pass@123"\n}` },
        { title:"Admin creds", text:`{\n  "username": "test.admin",\n  "password": "Pass@123"\n}` },
      ]
    },
    {
      id:"auth-header",
      group:"Everybody",
      role:["all"],
      method:"INFO",
      path:"Authorization Header",
      auth:true,
      tags:["auth","bearer","jwt"],
      desc:"For secured APIs, send this header.",
      blocks:[
        { title:"Header", text:`Authorization: Bearer <access_token>` }
      ]
    },

    // Auth (proxy)
    {
      id:"auth-login",
      group:"Auth",
      role:["all"],
      method:"POST",
      path:"/api/auth/login",
      auth:false,
      tags:["auth","login","token"],
      desc:"Proxy login to Keycloak (MVP/testing). Body is LoginRequest(username,password).",
      blocks:[
        { title:"Body", text:`{\n  "username": "test.admin",\n  "password": "Pass@123"\n}` },
        { title:"curl", text:`curl -X POST http://localhost:7029/api/auth/login \\\n  -H "Content-Type: application/json" \\\n  -d '{ "username":"test.admin","password":"Pass@123" }'` }
      ]
    },

    // AuthTester
    {
      id:"at-token",
      group:"AuthTester",
      role:["all"],
      method:"POST",
      path:"/api/auth-tester/token",
      auth:false,
      tags:["auth-tester","token","keycloak"],
      desc:"Gets token from Keycloak using PasswordGrantRequest(username,password).",
      blocks:[
        { title:"Body", text:`{\n  "username": "test.buyer",\n  "password": "Pass@123"\n}` },
        { title:"curl", text:`curl -X POST http://localhost:7029/api/auth-tester/token \\\n  -H "Content-Type: application/json" \\\n  -d '{ "username":"test.buyer","password":"Pass@123" }'` }
      ]
    },
    {
      id:"at-inspect",
      group:"AuthTester",
      role:["all"],
      method:"POST",
      path:"/api/auth-tester/inspect",
      auth:false,
      tags:["auth-tester","inspect","jwt"],
      desc:"IMPORTANT: body is a JSON string token (quotes included).",
      blocks:[
        { title:"Body (JSON string)", text:`"<paste_access_token_here>"` }
      ]
    },
    {
      id:"at-userinfo",
      group:"AuthTester",
      role:["all"],
      method:"POST",
      path:"/api/auth-tester/userinfo",
      auth:false,
      tags:["auth-tester","userinfo"],
      desc:"Calls Keycloak userinfo. Body is JSON string token (quotes included).",
      blocks:[
        { title:"Body (JSON string)", text:`"<paste_access_token_here>"` }
      ]
    },
    {
      id:"at-whoami",
      group:"AuthTester",
      role:["all"],
      method:"POST",
      path:"/api/auth-tester/whoami",
      auth:false,
      tags:["auth-tester","whoami"],
      desc:"Calls your API /api/whoami using the token. Body is JSON string token (quotes included).",
      blocks:[
        { title:"Body (JSON string)", text:`"<paste_access_token_here>"` }
      ]
    },
    {
      id:"at-all",
      group:"AuthTester",
      role:["all"],
      method:"POST",
      path:"/api/auth-tester/all",
      auth:false,
      tags:["auth-tester","full-run"],
      desc:"Does token + inspect + userinfo + whoami. Body is PasswordGrantRequest(username,password).",
      blocks:[
        { title:"Body", text:`{\n  "username": "test.seller",\n  "password": "Pass@123"\n}` }
      ]
    },

    // Diagnostics
    {
      id:"diag-kc",
      group:"Diag",
      role:["all"],
      method:"GET",
      path:"/api/diag/keycloak",
      auth:false,
      tags:["diag","keycloak","oidc"],
      desc:"Fetches Keycloak OIDC discovery and returns issuer/jwks_uri.",
      blocks:[
        { title:"curl", text:`curl http://localhost:7029/api/diag/keycloak` }
      ]
    },

    // Identity
    {
      id:"me",
      group:"Me",
      role:["admin","seller","buyer"],
      method:"GET",
      path:"/api/me",
      auth:true,
      tags:["me","claims"],
      desc:"Returns { sub, username, roles } for the current logged-in user.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <access_token>` }
      ]
    },
    {
      id:"me-seller",
      group:"Me",
      role:["seller"],
      method:"GET",
      path:"/api/me/seller-only",
      auth:true,
      tags:["seller-only"],
      desc:"Seller-only check endpoint.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <seller_token>` }
      ]
    },
    {
      id:"validate-user",
      group:"ValidateUser",
      role:["admin","seller","buyer"],
      method:"GET",
      path:"/api/validate-user",
      auth:true,
      tags:["validate-user","claims"],
      desc:"Any authenticated user. Returns { authenticated, sub, username, roles, loginAs }.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <access_token>` }
      ]
    },
    {
      id:"whoami",
      group:"WhoAmI",
      role:["admin","seller","buyer"],
      method:"GET",
      path:"/api/whoami",
      auth:true,
      tags:["whoami"],
      desc:"Any authenticated user. Returns { username, roles }.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <access_token>` }
      ]
    },

    // Admin
    {
      id:"admin-pending",
      group:"Admin",
      role:["admin"],
      method:"GET",
      path:"/api/admin/pending-category-requests",
      auth:true,
      tags:["admin","approval","category"],
      desc:"Lists pending seller category approval requests. Returns objects with Id, Type, SellerSub, CategoryId, Status, CreatedUtc.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <admin_token>` },
        { title:"curl", text:`curl http://localhost:7029/api/admin/pending-category-requests \\\n  -H "Authorization: Bearer <admin_token>"` }
      ]
    },
    {
      id:"admin-approve",
      group:"Admin",
      role:["admin"],
      method:"POST",
      path:"/api/admin/approve-category-request",
      auth:true,
      tags:["admin","approval","category"],
      desc:"Approves a category request by RequestId. Body is ApproveCategoryRequestDto { requestId }.",
      blocks:[
        { title:"Body", text:`{\n  "requestId": 12\n}` },
        { title:"curl", text:`curl -X POST http://localhost:7029/api/admin/approve-category-request \\\n  -H "Authorization: Bearer <admin_token>" \\\n  -H "Content-Type: application/json" \\\n  -d '{ "requestId": 12 }'` }
      ]
    },

    // NOTE: user listed this endpoint, but it's not in the zip you shared.
    {
      id:"admin-create-seller",
      group:"AdminUsers",
      role:["admin"],
      method:"POST",
      path:"/api/admin/users/create-seller",
      auth:true,
      tags:["admin","users","keycloak"],
      desc:"Listed by you, but NOT present in the uploaded zip‚Äôs controllers. If it exists in your latest branch, paste the DTO/controller and I‚Äôll align it 1:1.",
      blocks:[
        { title:"Placeholder Body (likely)", text:`{\n  "username": "seller.new1",\n  "password": "Pass@123"\n}` }
      ],
      warn:true
    },

    // Seller
    {
      id:"seller-cat-post",
      group:"Seller",
      role:["seller"],
      method:"POST",
      path:"/api/seller/category-requests",
      auth:true,
      tags:["seller","category","approval"],
      desc:"Creates a category approval request. Body is CategoryRequestCreate { categoryId }.",
      blocks:[
        { title:"Body", text:`{\n  "categoryId": 100\n}` },
        { title:"curl", text:`curl -X POST http://localhost:7029/api/seller/category-requests \\\n  -H "Authorization: Bearer <seller_token>" \\\n  -H "Content-Type: application/json" \\\n  -d '{ "categoryId": 100 }'` }
      ]
    },
    {
      id:"seller-cat-get",
      group:"Seller",
      role:["seller"],
      method:"GET",
      path:"/api/seller/category-requests",
      auth:true,
      tags:["seller","category","approval"],
      desc:"Lists my category requests (Approved/Pending).",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <seller_token>` }
      ]
    },
    {
      id:"seller-feedback",
      group:"Seller",
      role:["seller"],
      method:"GET",
      path:"/api/seller/feedback",
      auth:true,
      tags:["seller","feedback"],
      desc:"Lists feedback for my own products.",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <seller_token>` }
      ]
    },

    // Products
    {
      id:"products-get",
      group:"Products",
      role:["all"],
      method:"GET",
      path:"/api/products",
      auth:false,
      tags:["products","public"],
      desc:"Public list of products only for approved seller-category pairs.",
      blocks:[
        { title:"curl", text:`curl http://localhost:7029/api/products` }
      ]
    },
    {
      id:"products-post",
      group:"Products",
      role:["seller"],
      method:"POST",
      path:"/api/products",
      auth:true,
      tags:["products","seller"],
      desc:"Create a product (seller only). Body is CreateProductRequest(CategoryId, Name, Price).",
      blocks:[
        { title:"Body", text:`{\n  "categoryId": 100,\n  "name": "Wireless Mouse",\n  "price": 899.00\n}` }
      ]
    },

    // Orders
    {
      id:"orders-post",
      group:"Orders",
      role:["buyer"],
      method:"POST",
      path:"/api/orders",
      auth:true,
      tags:["orders","buyer"],
      desc:"Place order (buyer only). Body is CreateOrderRequest { items: [{ productId, qty }] }.",
      blocks:[
        { title:"Body", text:`{\n  "items": [\n    { "productId": 101, "qty": 2 }\n  ]\n}` }
      ]
    },
    {
      id:"orders-get",
      group:"Orders",
      role:["buyer"],
      method:"GET",
      path:"/api/orders",
      auth:true,
      tags:["orders","buyer"],
      desc:"Get my orders (buyer only).",
      blocks:[
        { title:"Headers", text:`Authorization: Bearer <buyer_token>` }
      ]
    },

    // Feedback
    {
      id:"feedback-post",
      group:"Feedback",
      role:["buyer"],
      method:"POST",
      path:"/api/feedback",
      auth:true,
      tags:["feedback","buyer"],
      desc:"Submit feedback (buyer only). Body is CreateFeedbackRequest(ProductId, Rating, Comment).",
      blocks:[
        { title:"Body", text:`{\n  "productId": 101,\n  "rating": 4,\n  "comment": "Good quality and fast delivery"\n}` }
      ]
    },
    {
      id:"feedback-get",
      group:"Feedback",
      role:["all"],
      method:"GET",
      path:"/api/feedback/{productId}",
      auth:false,
      tags:["feedback","public"],
      desc:"Public feedback list for a product.",
      blocks:[
        { title:"Example", text:`GET /api/feedback/101` }
      ]
    }
  ];

  // -------------------------
  // Rendering + filtering
  // -------------------------
  const listEl = document.getElementById("list");
  const qEl = document.getElementById("q");
  const methodEl = document.getElementById("method");
  const authOnlyEl = document.getElementById("authOnly");

  function setActiveTab(role){
    ["all","admin","seller","buyer"].forEach(r=>{
      const el = document.getElementById("t-"+r);
      el.classList.toggle("active", r===role);
    });
  }

  function roleMatch(ep, role){
    if (role === "all") return true; // Everybody view shows everything
    // endpoints with role:["all"] should appear for all roles
    if (ep.role.includes("all")) return true;
    return ep.role.includes(role);
  }

  function methodMatch(ep, method){
    if (method === "all") return true;
    return ep.method === method;
  }

  function queryMatch(ep, query){
    if (!query) return true;
    const hay = [
      ep.group, ep.method, ep.path, ep.desc,
      ...(ep.tags||[]),
      ...(ep.role||[])
    ].join(" ").toLowerCase();
    return hay.includes(query.toLowerCase());
  }

  function authMatch(ep, authOnly){
    if (!authOnly) return true;
    return ep.auth === true;
  }

  function render(role){
    const query = qEl.value.trim();
    const method = methodEl.value;
    const authOnly = authOnlyEl.checked;

    const filtered = endpoints.filter(ep =>
      roleMatch(ep, role) &&
      methodMatch(ep, method) &&
      queryMatch(ep, query) &&
      authMatch(ep, authOnly)
    );

    listEl.innerHTML = "";

    filtered.forEach(ep => {
      const card = document.createElement("div");
      card.className = "card";

      const methodSpan = ep.method === "GET" ? "GET" : (ep.method === "POST" ? "POST" : ep.method);
      const methodClass = ep.method === "GET" ? "GET" : (ep.method === "POST" ? "POST" : "");

      const tags = (ep.tags||[]).slice(0, 6).map(t => `<span class="pill">${t}</span>`).join("");
      const authPill = ep.auth ? `<span class="pill warn">auth required</span>` : `<span class="pill ok">public</span>`;
      const warnPill = ep.warn ? `<span class="pill bad">not in current zip</span>` : "";

      card.innerHTML = `
        <h2>${ep.group}</h2>
        <div class="meta">
          <span class="method ${methodClass}">${methodSpan}</span>
          <span class="path">${ep.path}</span>
          ${authPill}
          ${warnPill}
          ${tags}
        </div>
        <div class="desc">${ep.desc || ""}</div>
      `;

      (ep.blocks || []).forEach((b, i) => {
        const id = `${ep.id}-b${i}`;
        const wrap = document.createElement("div");
        wrap.className = "code-wrap";
        wrap.innerHTML = `
          <button class="copy-btn" data-copy="${id}">üìã Copy</button>
          <pre id="${id}">${b.text}</pre>
          <div class="small" style="margin-top:8px;">${b.title}</div>
        `;
        card.appendChild(wrap);
      });

      listEl.appendChild(card);
    });

    // wire copy buttons
    document.querySelectorAll(".copy-btn").forEach(btn => {
      btn.onclick = async () => {
        const id = btn.getAttribute("data-copy");
        const el = document.getElementById(id);
        const txt = (el?.textContent || "").trim();
        try {
          await copyText(txt);
          const old = btn.textContent;
          btn.textContent = "‚úì Copied";
          btn.classList.add("ok");
          setTimeout(()=>{ btn.textContent = old; btn.classList.remove("ok"); }, 900);
        } catch {
          alert("Copy failed. Please select text manually.");
        }
      };
    });
  }

  // -------------------------
  // Routing (URLs)
  // -------------------------
  function setUrls(){
    const base = location.href.split("#")[0];
    document.getElementById("uAll").textContent = base + "#/all";
    document.getElementById("uAdmin").textContent = base + "#/admin";
    document.getElementById("uSeller").textContent = base + "#/seller";
    document.getElementById("uBuyer").textContent = base + "#/buyer";
  }

  function route(){
    setUrls();
    const h = (location.hash || "#/all").toLowerCase();
    let role = "all";
    if (h.startsWith("#/admin")) role = "admin";
    else if (h.startsWith("#/seller")) role = "seller";
    else if (h.startsWith("#/buyer")) role = "buyer";
    else role = "all";

    setActiveTab(role);
    render(role);
  }

  // UI events
  qEl.addEventListener("input", route);
  methodEl.addEventListener("change", route);
  authOnlyEl.addEventListener("change", route);
  window.addEventListener("hashchange", route);

  // boot
  route();
</script>
</body>
</html>
